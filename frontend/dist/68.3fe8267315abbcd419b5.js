"use strict";(self.webpackChunkaidforge_frontend=self.webpackChunkaidforge_frontend||[]).push([[68],{7068:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var n=a(6540),r=a(3840),l=a(9290),o=a(551),c=a(5353),s=a(7234),i=a(9146),d=a(4812),m=a(5773),u=a(2609),h=a(3738),E=a(2709),f=a(208),g=a(3034),p=a(1738),y=a(4466),b=a(6944),w=a(3246),S=a(5800),T=a(548),D=a(7998),x=a(1994),A=a(9546),I=a(1052),k=a(954),_=a(1904),z=a(4801),C=a(9632);const v=()=>{const{user:e}=(0,C.A)(),[t,a]=(0,n.useState)([]),[v,H]=(0,n.useState)(!0),[P,R]=(0,n.useState)(null),W=(0,r.dU)("white","gray.800"),$=(0,r.dU)("gray.200","gray.700"),F=t.reduce(((e,t)=>e+parseFloat(t.amount)),0).toFixed(4),M=t.filter((e=>"completed"===e.status)).length,O=async()=>{try{H(!0),R(null),console.log("Attempting to fetch donations history...");try{const e=await z.NQ.getDonations();console.log("Donation API response:",e),a(Array.isArray(e.data)?e.data:[])}catch(e){console.error("Regular API call failed:",e);try{const e="http://localhost:4000/api",t=await fetch(`${e}/donors/view-donations`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),n=await t.json();console.log("Direct fetch response:",n),a(Array.isArray(n)?n:[])}catch(e){throw console.error("Direct fetch also failed:",e),new Error("Could not connect to donation history API")}}}catch(e){console.error("Error fetching donations:",e),R("Failed to load your donations. Please try again later."),a([{_id:"1",amount:"0.5",cause:"food_supplies",status:"completed",createdAt:new Date(Date.now()-6048e5).toISOString(),transactionHash:"0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef",paymentMethod:"crypto"},{_id:"2",amount:"0.25",cause:"medical_aid",status:"completed",createdAt:new Date(Date.now()-12096e5).toISOString(),transactionHash:"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890",paymentMethod:"crypto"},{_id:"3",amount:"0.1",cause:"education",status:"processing",createdAt:new Date(Date.now()-1728e5).toISOString(),transactionHash:null,paymentMethod:"crypto"}])}finally{H(!1)}};(0,n.useEffect)((()=>{O()}),[]);const j=e=>{switch(e){case"completed":return"green";case"processing":return"yellow";case"failed":return"red";default:return"gray"}};return n.createElement(l.m,{maxW:"container.xl",py:8},n.createElement(o.T,{spacing:6,align:"stretch"},n.createElement(c.D,{as:"h1",size:"xl"},"Your Donations"),n.createElement(s.s,{direction:{base:"column",md:"row"},gap:6,mb:4},n.createElement(i.a,{flex:"1",bg:W,p:6,borderRadius:"lg",borderWidth:"1px",borderColor:$,shadow:"md"},n.createElement(d.r,null,n.createElement(m.v,{fontSize:"lg"},"Total Donated"),n.createElement(u.z,{alignItems:"center"},n.createElement(h.I,{as:_.liQ}),n.createElement(E.k,{fontSize:"3xl"},F," ETH")),n.createElement(f.h,null,"Lifetime contribution"))),n.createElement(i.a,{flex:"1",bg:W,p:6,borderRadius:"lg",borderWidth:"1px",borderColor:$,shadow:"md"},n.createElement(d.r,null,n.createElement(m.v,{fontSize:"lg"},"Completed Donations"),n.createElement(E.k,{fontSize:"3xl"},M),n.createElement(f.h,null,"Out of ",t.length," total donations")))),n.createElement(s.s,{justify:"space-between",mb:4},n.createElement(g.$,{leftIcon:n.createElement(_.Lsu,null),onClick:O,isLoading:v,loadingText:"Refreshing..."},"Refresh"),n.createElement(u.z,null,n.createElement(g.$,{leftIcon:n.createElement(_.KSO,null)},"Verify on Blockchain"),n.createElement(g.$,{leftIcon:n.createElement(_.WCW,null),colorScheme:"blue"},"Download Report"))),n.createElement(i.a,{bg:W,borderRadius:"lg",borderWidth:"1px",borderColor:$,shadow:"lg",overflow:"hidden"},v?n.createElement(s.s,{justify:"center",align:"center",p:10},n.createElement(p.y,{size:"xl"})):P?n.createElement(y.F,{status:"error"},n.createElement(b._,null),P):0===t.length?n.createElement(y.F,{status:"info"},n.createElement(b._,null),"You haven't made any donations yet. Start making a difference today!"):n.createElement(i.a,{overflowX:"auto"},n.createElement(w.X,{variant:"simple"},n.createElement(S.d,null,n.createElement(T.Tr,null,n.createElement(D.Th,null,"Date"),n.createElement(D.Th,null,"Amount"),n.createElement(D.Th,null,"Purpose"),n.createElement(D.Th,null,"Status"),n.createElement(D.Th,null,"Payment Method"),n.createElement(D.Th,null,"Transaction ID"))),n.createElement(x.N,null,t.map((e=>{return n.createElement(T.Tr,{key:e._id},n.createElement(A.Td,null,(t=e.createdAt,new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))),n.createElement(A.Td,null,n.createElement(u.z,null,n.createElement(h.I,{as:_.liQ}),n.createElement(I.E,null,e.amount," ETH"))),n.createElement(A.Td,null,e.cause.replace("_"," ").split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")),n.createElement(A.Td,null,n.createElement(k.E,{colorScheme:j(e.status)},e.status)),n.createElement(A.Td,null,e.paymentMethod),n.createElement(A.Td,null,n.createElement(I.E,{isTruncated:!0,maxW:"150px"},e.transactionHash?n.createElement("a",{href:`https://etherscan.io/tx/${e.transactionHash}`,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"underline",color:"blue"}},e.transactionHash.substring(0,10),"..."):"Pending")));var t}))))))))}}}]);