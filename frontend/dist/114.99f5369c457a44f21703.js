"use strict";(self.webpackChunkaidforge_frontend=self.webpackChunkaidforge_frontend||[]).push([[114],{6114:(e,t,n)=>{n.r(t),n.d(t,{default:()=>X});var a=n(6540),l=n(2468),r=n(3840),o=n(2280),i=n(913),c=n(5958),s=n(6771),m=n(9146),u=n(7234),d=n(1052),E=n(954),p=n(2609),g=n(5353),h=n(551),y=n(9290),f=n(4466),b=n(6944),v=n(1175),T=n(8995),D=n(7584),w=n(6277),S=n(536),A=n(8129),x=n(3738),C=n(6833),M=n(5187),z=n(5712),k=n(9378),R=n(3034),H=n(3812),W=n(1082),I=n(7069),N=n(63),Q=n(6808),F=n(1892),P=n(3246),_=n(5800),j=n(548),K=n(7998),B=n(1994),J=n(9546),O=n(1904),q=n(4801),L=n(9632),U=n(2392),$=n(8873);const X=()=>{const{user:e}=(0,L.A)(),t=(0,l.d)(),n=(0,r.dU)("white","gray.800"),X=(0,r.dU)("gray.200","gray.700"),[Y,Z]=(0,a.useState)(!1),[G,V]=(0,a.useState)([]),[ee,te]=(0,a.useState)([]),[ne,ae]=(0,a.useState)(!1),[le,re]=(0,a.useState)([]),[oe,ie]=(0,a.useState)([]),[ce,se]=(0,a.useState)(null),[me,ue]=(0,a.useState)({amount:"0.01",cause:"",message:"",paymentMethod:"crypto"});(0,a.useEffect)((()=>{de(),Ee(),pe()}),[]);const de=async()=>{try{ae(!0);const e=await q.NQ.getDonations();if(e?.data){console.log("Donation data received:",e.data);const t=e.data.map((e=>{const t={...e};return t.date||(t.createdAt?t.date=t.createdAt:t.timestamp?t.date=t.timestamp:(t.date=(new Date).toISOString(),console.log(`Adding current date to donation ID: ${t.id||"unknown"}`))),t}));V(t),console.log("Processed donations with dates:",t)}}catch(e){console.error("Error fetching donation history:",e),t({title:"Error",description:"Failed to load your donation history",status:"error",duration:5e3,isClosable:!0})}finally{ae(!1)}},Ee=async()=>{try{const e=await q.jb.getEnhancedAidRecords();e?.data?.success&&e.data.records&&re(e.data.records)}catch(e){console.error("Error fetching enhanced aid records:",e)}},pe=async()=>{try{const e=await q.jb.getRecentEvents();e?.data?.success&&ie(e.data.events)}catch(e){console.error("Error fetching donation activity:",e)}},ge=e=>{const{name:t,value:n}=e.target;ue({...me,[t]:n})};return a.createElement(y.m,{maxW:"container.lg",py:8},a.createElement(h.T,{spacing:8,align:"stretch"},a.createElement(g.D,{as:"h1",size:"xl",textAlign:"center"},"Make a Donation"),a.createElement(f.F,{status:"info",variant:"subtle",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",borderRadius:"lg",mb:6},a.createElement(b._,{boxSize:"40px",mr:0}),a.createElement(v.X,{mt:4,mb:1,fontSize:"lg"},"Your Support Makes a Difference"),a.createElement(T.T,{maxWidth:"sm"},"Your donation will be securely recorded on the blockchain for transparency and traceability.")),a.createElement(m.a,{p:8,borderWidth:"1px",borderRadius:"lg",borderColor:X,bg:n,shadow:"xl"},a.createElement("form",{onSubmit:async e=>{if(e.preventDefault(),me.amount&&me.cause)if(parseFloat(me.amount)<.01)t({title:"Invalid Amount",description:"Minimum donation amount is 0.01 ETH",status:"error",duration:3e3,isClosable:!0});else try{Z(!0);const e=await q.NQ.makeDonation({amount:me.amount,cause:me.cause,message:me.message,paymentMethod:me.paymentMethod});if(!e?.data?.success)throw new Error(e?.data?.error||"Donation failed");t({title:"Donation Successful",description:"Thank you for your donation! Transaction is being processed.",status:"success",duration:5e3,isClosable:!0}),ue({amount:"0.01",cause:"",message:"",paymentMethod:"crypto"}),await de(),await pe()}catch(e){console.error("Error making donation:",e);const n=e.response?.data?.error||e.message;t({title:"Donation Failed",description:n||"An error occurred while processing your donation",status:"error",duration:5e3,isClosable:!0})}finally{Z(!1)}else t({title:"Missing Fields",description:"Please fill in all required fields",status:"error",duration:3e3,isClosable:!0})}},a.createElement(h.T,{spacing:6,align:"stretch"},a.createElement(D.MJ,{isRequired:!0},a.createElement(w.l,{fontWeight:"bold"},"Donation Amount (ETH)"),a.createElement(S.M,null,a.createElement(A.W,{pointerEvents:"none"},a.createElement(x.I,{as:O.liQ,color:"gray.500"})),a.createElement(C.Q7,{min:.01,step:.01,value:me.amount,onChange:e=>{ue({...me,amount:e})},w:"100%"},a.createElement(C.OO,{pl:10}),a.createElement(C.lw,null,a.createElement(C.Q0,null),a.createElement(C.Sh,null)))),a.createElement(D.eK,null,"Minimum donation is 0.01 ETH")),a.createElement(D.MJ,{isRequired:!0},a.createElement(w.l,{fontWeight:"bold"},"Donation Purpose"),a.createElement(M.l,{name:"cause",value:me.cause,onChange:ge,placeholder:"Select purpose"},a.createElement("option",{value:"emergency_relief"},"Emergency Relief"),a.createElement("option",{value:"food_supplies"},"Food Supplies"),a.createElement("option",{value:"medical_aid"},"Medical Aid"),a.createElement("option",{value:"shelter"},"Shelter"),a.createElement("option",{value:"education"},"Education"),a.createElement("option",{value:"general"},"General Fund")),a.createElement(D.eK,null,"Select where you want your donation to go")),a.createElement(D.MJ,null,a.createElement(w.l,{fontWeight:"bold"},"Payment Method"),a.createElement(M.l,{name:"paymentMethod",value:me.paymentMethod,onChange:ge},a.createElement("option",{value:"crypto"},"Cryptocurrency (ETH)"),a.createElement("option",{value:"creditCard"},"Credit Card"),a.createElement("option",{value:"bankTransfer"},"Bank Transfer"))),a.createElement(D.MJ,null,a.createElement(w.l,{fontWeight:"bold"},"Message (Optional)"),a.createElement(z.T,{name:"message",value:me.message,onChange:ge,placeholder:"Add a personal message",resize:"vertical"}),a.createElement(D.eK,null,"Leave a message for the recipients (optional)")),a.createElement(k.c,null),a.createElement(p.z,{justifyContent:"center"},a.createElement(R.$,{type:"submit",colorScheme:"green",size:"lg",isLoading:Y,loadingText:"Processing...",leftIcon:a.createElement(x.I,{as:O._oH}),px:10},"Donate Now"))))),a.createElement(H.t,{variant:"enclosed",mt:8},a.createElement(W.w,null,a.createElement(I.o,null,"Donation History"),a.createElement(I.o,null,"Recipient Details"),a.createElement(I.o,null,"Activity Log")),a.createElement(N.T,null,a.createElement(Q.K,null,ne?a.createElement(c.B,{spacing:4},a.createElement(F.E,{height:"60px"}),a.createElement(F.E,{height:"60px"}),a.createElement(F.E,{height:"60px"})):a.createElement(P.X,{variant:"simple"},a.createElement(_.d,null,a.createElement(j.Tr,null,a.createElement(K.Th,null,"Amount (ETH)"),a.createElement(K.Th,null,"Cause"),a.createElement(K.Th,null,"Date (Indian Time)"),a.createElement(K.Th,null,"Status"))),a.createElement(B.N,null,G.length>0?G.map(((e,t)=>a.createElement(j.Tr,{key:t},a.createElement(J.Td,null,(0,$.Q9)(e.amount)),a.createElement(J.Td,null,e.cause),a.createElement(J.Td,null,(0,$.x5)(e.date)),a.createElement(J.Td,null,a.createElement(E.E,{colorScheme:"Completed"===e.status?"green":"yellow"},e.status||"Processing"))))):a.createElement(j.Tr,null,a.createElement(J.Td,{colSpan:4,textAlign:"center"},"No donation history found"))))),a.createElement(Q.K,null,a.createElement(g.D,{size:"md",mb:4},"Aid Recipients"),le.length>0?le.map(((e,t)=>a.createElement(m.a,{key:t},(e=>a.createElement(o.Z,{size:"sm",variant:"outline",mb:3,borderColor:X},a.createElement(i.b,{py:3,px:4},a.createElement(c.B,{direction:"row",spacing:4,align:"center"},a.createElement(s.e,{icon:a.createElement(O.x$1,null),bg:e.recipientDetails?"green.500":"gray.400",size:"sm"}),a.createElement(m.a,{flex:"1"},a.createElement(u.s,{justify:"space-between",align:"center"},a.createElement(m.a,null,a.createElement(U.A,{address:e.recipient,showBadge:!0,size:"md"}),e.recipientDetails&&a.createElement(d.E,{fontSize:"sm",color:"gray.500"},e.recipientDetails.location||"No location info")),a.createElement(E.E,{colorScheme:"Delivered"===e.status?"green":"Pending"===e.status?"yellow":"blue"},e.status)),a.createElement(p.z,{spacing:4,mt:2,fontSize:"sm"},a.createElement(d.E,null,a.createElement("strong",null,"Aid:")," ",e.aidType),a.createElement(d.E,null,a.createElement("strong",null,"Amount:")," ",(0,$.Q9)(e.amount)," ETH"),a.createElement(d.E,null,a.createElement("strong",null,"Date:")," ",(0,$.x5)(e.timestamp))))))))(e)))):a.createElement(d.E,{textAlign:"center",py:4,color:"gray.500"},"No aid recipients found. This could be because no aid has been distributed yet.")),a.createElement(Q.K,null,a.createElement(m.a,{mt:4},a.createElement(g.D,{size:"md",mb:4},"Recent Donation Activity"),a.createElement(c.B,{spacing:3},oe.map(((e,t)=>a.createElement(o.Z,{key:t,variant:"outline"},a.createElement(i.b,null,a.createElement(p.z,{justify:"space-between"},a.createElement(h.T,{align:"start",spacing:1},a.createElement(d.E,{fontWeight:"bold"},"DonationReceived"===e.eventType?"New Donation":"AidDistributed"===e.eventType?"Aid Distributed":"Aid Status Updated"),a.createElement(d.E,{fontSize:"sm"},"Amount: ",(0,$.Q9)(e.amount)," ETH"),e.recipient&&a.createElement(d.E,{fontSize:"sm"},"Recipient: ",a.createElement(U.A,{address:e.recipient}))),a.createElement(E.E,{colorScheme:"DonationReceived"===e.eventType?"green":"AidDistributed"===e.eventType?"blue":"yellow"},(0,$.x5)(e.timestamp))))))))))))))}}}]);